[Unit]
  Description=Humio service
  After=network.service

[Service]
  Type=notify
  Restart=on-abnormal
  User=humio
  Group=humio
  LimitNOFILE=250000:250000
  EnvironmentFile=/etc/humio/server_{{ item }}.conf
  EnvironmentFile=/etc/humio/server_all.conf
  EnvironmentFile=/etc/humio/server_user_{{ item }}.conf
  WorkingDirectory={{ humio_data_path }}/{{ humio_host_id }}-{{ item }}
  ExecStart=/usr/bin/numactl --cpunodebind={{ ansible_local.numanodes[item|string].nodes }} --membind={{ ansible_local.numanodes[item|string].nodes }} /usr/bin/java {{ humio_java_opts | join(" ") }} -jar /usr/lib/humio/server-{{ humio_version }}.jar

[Install]
  WantedBy=default.target
